# 1. 项目简介

本项目是基于cocos2d-x引擎实现的塔防游戏……

# 2. 实现的功能及其实现方法

## 2.1 计时器

……

## 2.2 Buff

……

## 2.3 动画效果及音效

### 2.3.1 敌人动画

1. 敌人入场动画
   敌人经过 0.25s 的淡入效果的**同时**，开始正常按照预设路线移动。这是通过 cocos2d-x内置的动画接口实现的。

   ![1731203429837](README.assets/1731203429837.png)

2. 敌人移动动画
   当后端逻辑中调用了 on_enemy_move 这个回调函数之后，会执行前端 EnemyAnimation 的 move 函数，它首先会判断下一格与当前格之间的曼哈顿距离是否超过 1，用于检测敌人是正常行走还是进行传送。
   如果是正常行走，则会通过敌人的类型获取到它的移动速度，根据移动速度的数值计算一格的距离应该被分成几份，将动作进行分解，每个分解动作会让敌人有个微小的位移，并更新敌人的帧动画。同时，也会判断敌人的前进方向，决定是否要将图片翻转。

   ![1731204917838](README.assets/1731204917838.png)
   如果是传送，会转而执行 EnemyAnimation::transport 函数，它会根据移动速度计算动画时间，先后进行缩小、瞬移、放大的效果。
   ![1731204967851](README.assets/1731204967851.png)

3. 敌人死亡动画
   在敌人血量归零之后，后端执行 on_enemy_death 回调，调用前端的 EnemyAnimation::dead 函数，函数中根据敌人的类型分类进行处理。
   如果是没有任何亡语的普通敌人，会直接通过 cocos2d-x 播放帧动画的接口，调用死亡动画，之后再播放淡出效果。
   如果是有亡语的普通敌人，即唯一的 Worm 对象，除了普通死亡动画之外，由于其还会降低其周围 8 格塔的攻击速度，死亡时不仅会在死亡位置释放一个淡蓝色光环的粒子效果，还会在受到减速效果的塔上放置一个雪花的标志，并在效果结束后消失。
   如果是处于一阶段的 Boss，由于会转成二阶段，需要单独处理，在播放完复活动画之后，在原地新创建一个 Boss2 对象，并将原来的对象析构。
   ![1731206160227](README.assets/1731206160227.png)

4. 特殊敌人技能动画

   在后端执行 on_enemy_release_skill 的回调时，会执行 EnemyAnimation::releaseSkill 函数，针对不同敌人的技能进行处理：

   + 每隔一段时间降低周围塔的攻击力：播放敌人专属的释放技能动画，在此期间敌人不会移动，并在当前位置释放一个红色光环的粒子效果，在受到影响的塔上放置一个破损的剑作为标志，在效果结束后消失。播放专属音效。
   + 每隔一段时间恢复周围敌人的血量：没有专属动画，敌人继续保持移动，在释放技能时的位置释放一个绿色光环的粒子效果。
   + 自身周围的敌人移速提升：没有专属动画，敌人继续保持移动，在释放技能时的位置释放一个深蓝色光环的粒子效果。播放专属音效。
   + 无敌：在受到第一次攻击后自身透明度降低，在此期间仍然会移动，仍然会被塔锁定，效果结束后透明度恢复。
   + Boss1 技能：降低所有塔的攻击速度，并使所有塔无法释放技能，播放专属的释放技能动画，在此期间敌人不会移动，在所有塔上放置雪花标志和眩晕标志。
   + Boss2 技能：除了拥有 Boss1 所有的技能之外，还会拆除离自己最近的一个塔，同样会播放专属的释放技能动画，在此期间敌人不会移动。

5. 帧动画的制作及动画的补充说明
   敌人动画的绝大多数原始素材是 .webp 格式的，本项目首先将其转为 .mp4 格式，再转为 .gif 格式，通过 ps 软件将每一帧的背景扣成透明，并导出成一张张帧动画。
   由于在上述过程中不是所有敌人动画在图片中都是居中，在播放敌人死亡或技能动画时还添加了偏置值。

### 2.3.2 子弹动画

在后端执行 on_enemy_attacked 的回调时，会创建一个 Bullet 对象，通过判断塔的类型，决定是普通的 Bullet 对象还是其子类 MagicBullet。不管是哪一种，子弹都会自动跟踪敌人，在每一帧计算自身与敌人的夹角和 x, y 方向上的距离，通过夹角进行旋转，通过距离决定子弹的移动速度（距离越远，速度越快）。
![1731208244345](README.assets/1731208244345.png)

+ Bullet 对象
  在击中敌人之后在敌人身上释放出血的粒子动画
+ MagicBullet 对象
  在移动过程中还会播放移动的帧动画，击中敌人后原地释放爆炸动画

### 2.3.4 塔技能动画

在后端执行 on_tower_release_skill 的回调时，会执行 TowerAnimation::releaseSkill 函数，根据塔的类型，分类处理动画：

+ 简单地提升自身属性：在塔上放置一个透明的绿色光罩动画，效果结束后消失。
+ 下一次攻击有特殊效果：Bullet 为导弹爆炸动画；MagicBullet 为放大击中后的爆炸效果。并播放爆炸音效。
+ 在塔周围释放效果：在作用的每个格子上播放相应的粒子动画，具体有爆炸（有专属音效）、减速、减抗、燃烧等效果，效果结束后消失。
+ 提升周围塔的攻击力：在作用的塔上放置一把剑的标志，自身位置放置一个透明的绿色光罩动画，效果结束后消失。

### 2.3.5 其他粒子效果

1. 在点击鼠标时，会在点击位置播放一个小型的提示粒子效果。
2. 剧情界面放置的彩蛋通过点击一个粒子效果的部位触发。

### 2.3.6 其他音效

在以下场景中，也会播放音效：塔升级、敌人进点、游戏结束（胜利或失败）。

> 注：音乐和音效的音量可以在图鉴界面调整

## 2.4 存档

……

## 2.5 剧情

……

## 2.6 待补充

……

# 3. 组员及分工

